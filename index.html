<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FINAN√áAS EM DIA</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf/dist/jspdf.umd.min.js"></script>

<style>
:root{
--bg:#020617;--card:#020617;--border:#1e293b;
--text:#e5e7eb;--muted:#94a3b8;
--green:#22c55e;--red:#ef4444;--yellow:#facc15;--blue:#38bdf8;
}
.light{
--bg:#f8fafc;--card:#fff;--border:#e2e8f0;
--text:#020617;--muted:#475569;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--text);padding:16px}
.app{max-width:500px;margin:auto}
.card{background:var(--card);border:1px solid var(--border);
border-radius:16px;padding:14px;margin-bottom:14px}
h1{text-align:center;background:linear-gradient(90deg,var(--green),var(--blue));
-webkit-background-clip:text;-webkit-text-fill-color:transparent}
input,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;
border:1px solid var(--border);background:transparent;color:var(--text)}
button{background:var(--green);border:none;font-weight:bold;color:#022c22}
.actions{display:flex;gap:8px}
.actions button{flex:1;background:var(--blue);color:#020617}
.remove{background:var(--red)!important;color:#fff!important}
.alert{background:var(--yellow);color:#422006;padding:8px;border-radius:8px;font-size:13px}
.hidden{display:none}
</style>
</head>

<body>
<div class="app">

<h1>FINAN√áAS EM DIA</h1>

<!-- LOGIN -->
<div id="login" class="card">
  <input id="pin" type="password" placeholder="Digite seu PIN">
  <button onclick="login()">Entrar</button>
  <button onclick="createPin()">Criar / Alterar PIN</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<!-- ALERTAS -->
<div id="alerts"></div>

<!-- ADD -->
<div class="card">
  <input id="name" placeholder="D√≠vida">
  <input id="value" type="number" placeholder="Valor">
  <input id="date" type="date">
  <button onclick="addDebt()">Adicionar</button>
</div>

<!-- RELAT√ìRIO -->
<div class="card">
  <button onclick="exportMonthlyPDF()">üìÑ Gerar relat√≥rio mensal (PDF)</button>
</div>

<div id="list"></div>

</div>
</div>

<script>
let debts=JSON.parse(localStorage.getItem("debts"))||[];
let savedPin=localStorage.getItem("pin");

function createPin(){
  const p=prompt("Defina seu PIN");
  if(p){
    localStorage.setItem("pin",p);
    alert("PIN salvo!");
  }
}

function login(){
  if(pin.value===savedPin){
    loginDiv.style.display="none";
    appDiv.classList.remove("hidden");
    render();
  } else alert("PIN incorreto");
}

function save(){localStorage.setItem("debts",JSON.stringify(debts));render();}

function addDebt(){
  if(!name.value||!value.value||!date.value)return;
  debts.push({name:name.value,value:+value.value,date:date.value,paid:false});
  name.value=value.value=date.value="";
  save();
}

function togglePaid(i){debts[i].paid=!debts[i].paid;save();}
function removeDebt(i){debts.splice(i,1);save();}

function render(){
  list.innerHTML="";
  alertsDiv.innerHTML="";
  const today=new Date();

  debts.forEach((d,i)=>{
    const diff=(new Date(d.date)-today)/86400000;
    if(!d.paid && diff<=3){
      alertsDiv.innerHTML+=`
      <div class="alert">‚ö†Ô∏è ${d.name} vence em ${Math.ceil(diff)} dia(s)</div>`;
    }

    list.innerHTML+=`
    <div class="card">
      <strong>${d.name}</strong><br>
      R$ ${d.value} - ${new Date(d.date).toLocaleDateString()}
      <div class="actions">
        <button onclick="togglePaid(${i})">${d.paid?"Desfazer":"Pagar"}</button>
        <button class="remove" onclick="removeDebt(${i})">Remover</button>
      </div>
    </div>`;
  });
}

function exportMonthlyPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  const month=new Date().toISOString().slice(0,7);
  let y=10;
  let total=0;

  pdf.text(`Relat√≥rio Financeiro - ${month}`,10,y); y+=10;

  debts.filter(d=>d.date.startsWith(month)).forEach(d=>{
    pdf.text(`${d.name} - R$${d.value} - ${d.paid?"PAGA":"ABERTA"}`,10,y);
    if(d.paid) total+=d.value;
    y+=8;
  });

  pdf.text(`Total pago: R$ ${total.toFixed(2)}`,10,y+10);
  pdf.save(`relatorio-financeiro-${month}.pdf`);
}

const pin=document.getElementById("pin");
const loginDiv=document.getElementById("login");
const appDiv=document.getElementById("app");
const list=document.getElementById("list");
const alertsDiv=document.getElementById("alerts");
const name=document.getElementById("name");
const value=document.getElementById("value");
const date=document.getElementById("date");
</script>
</body>
</html>
